# EnglishCard — Telegram‑бот для изучения английских слов
## Описание
#### EnglishCard — Telegram‑бот для интерактивного изучения английских слов. Бот реализован на Python с использованием библиотеки `pyTelegramBotAPI`. 
#### Основные возможности:
* обучение через карточки с выбором перевода (1 правильный вариант из 4);
* персональная коллекция слов пользователя;
* переключение между общей базой слов и личной коллекцией;
* добавление и удаление слов из персональной коллекции.

#### Код бота состоит из обработчиков команд, функций работы с БД и логики отображения карточек.
### Структура кода
### Основные файлы
#### Проект состоит из двух основных файлов:
1. **`main.py` (основной файл бота):**
* инициализация бота и хранилища состояний (`StateMemoryStorage`);
* подключение к БД через функцию `get_conn_BD()` из модуля `conn_BD.py`;
* классы `Command` и `MyStates` для хранения меток кнопок и состояний бота;
* обработчики команд (`/start`, `/help`) и текстовых сообщений;
* логика создания и отображения карточек (`create_cards`, `message_reply`).
2. **`conn_BD.py` (модуль работы с БД):**
* содержит функцию `get_conn_BD()`, возвращающую соединение с СУБД;
* используется во всех функциях, взаимодействующих с БД.
#### Используемые классы и функции
##### Классы
1. `Command` — хранит текстовые метки кнопок интерфейса:
* `ADD_WORD` («Добавить слово»);
* `DELETE_WORD` («Удалить слово»);
* `NEXT` («Дальше ⏭»);
* `MYWORDS` («Мои слова»);
* `GENERAL` («Общие слова»).
2. `MyStates` (`StatesGroup`) — определяет состояния бота:
* `target_word` — состояние ожидания выбора перевода слова;
* `translate_word` — состояние ввода нового слова пользователем;
##### Основные функции
1. **`get_user_data`(`user_id`)** — получает текущее состояние пользователя из таблицы `users`:
* если пользователя нет в БД — создаёт запись с шагом 0;
* возвращает словарь с полями `step`, `target_word`, `translate_word`.
2. **`update_user_step`(`user_id, step`)** — обновляет шаг пользователя в таблице `users`.
3. **`save_target_word`(`user_id`, `target_word`, `translate_word`)** — сохраняет текущее слово и его перевод в users.
4. **`get_four_words`(`user_id`, `use_user_words`)** — выбирает случайное слово:
* из персональной коллекции (`userwords`), если `use_user_words=True`;
* из общей базы (`words`), если `use_user_words=False`.
5. `message_reply(message)` — обрабатывает текстовые сообщения:
   * проверяет правильность ответа;
   * показывает подсказки при ошибке;
   * формирует клавиатуру с вариантами.
### Обработчики команд
1. **`/start`** — запускает бота и начинает обучение:
* получает состояние пользователя;
* выбирает случайное слово;
* создаёт клавиатуру с вариантами ответа;
* сохраняет данные о карточке в хранилище состояний.
2.  **`/help`** — выводит справочную информацию о боте (форматирование с эмодзи и разделами).
3. **Кнопки интерфейса:**
* `«Дальше»` (NEXT) — вызывает функцию next_cards(message) для показа следующей карточки;
* `«Добавить слово»` (ADD_WORD) — переводит пользователя в состояние ввода нового слова (MyStates.translate_word);
* `«Удалить слово»` (DELETE_WORD) — удаляет текущее слово из таблицы userwords;
* `«Мои слова»` / `«Общие слова»` (MYWORDS / GENERAL) — переключают режим обучения (изменяют шаг в users).
## Работа с базой данных
Используются 3 таблицы:
1. `users` — состояние пользователя (поля: `user_id`, `step`, `target_word`, `translate_word`).
2. `userwords` — персональные слова пользователей (поля: `user_id`, `english_word`, `russian_translation`).
3. `words` — общая база слов (поля: `english_word`, `russian_translation`, `word_type`).
 * Все запросы к БД выполняются через курсор (`cursor`) с последующей фиксацией изменений (conn.commit()) и закрытием соединения (cursor.close()).
## Особенности реализации
* Сохранение состояний — используется `StateMemoryStorage` и дополнительное хранение в таблице `users`.
* Безопасность — токен бота хранится в переменной окружения `TOKEN`.
* Обработка ошибок — ошибки БД выводятся в консоль (например, в `get_four_words`).
* Логика карточек — правильный ответ помечается как `«Отлично!❤»`, неверный — с отметкой `«❌»`.
* Уникальность слов — перед добавлением нового слова проверяется его наличие в `userwords`.
## Требования к окружению
Для работы бота необходимы:
1. Python версии 3.8 или выше.
2. Библиотека `pyTelegramBotAPI` (`pip install pyTelegramBotAPI`).
3. СУБД (`PostgreSQL`, `SQLite` или `MySQL`) и модуль для работы с ней.
4. Файл `conn_BD.py` с функцией `get_conn_BD()`.
5. Переменная окружения `TOKEN` с токеном Telegram‑бота.
## Инструкция по запуску
1. Установите зависимости: `pip install pyTelegramBotAPI`.
2. Настройте подключение к БД в файле `conn_BD.py`.
3. Задайте переменную окружения `TOKEN`.
4. Запустите бот командой python `main.py`.
5. Отправьте боту команду `/start `для начала работы.
### *Возможные доработки*
1. *Добавить логирование в файл вместо консоли;*
2. *Реализовать кэширование часто используемых запросов к БД;*
3. *Расширить классы Command и MyStates для новых режимов обучения;*
4. *Добавить валидацию ввода при добавлении слов;*
5. *Интегрировать систему оценок или прогресса пользователя.*